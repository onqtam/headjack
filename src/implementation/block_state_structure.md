<div style="text-align: center;">
    <img src="https://png.pngitem.com/pimgs/s/207-2073499_translate-platform-from-english-to-spanish-work-in.png">
</div>


# Block & state structure


Look at ethereum block & state structure
https://ethereum.stackexchange.com/questions/268/ethereum-block-architecture
https://ethereum.org/en/developers/docs/data-structures-and-encoding/patricia-merkle-trie/


# Block structure

- Transactions (token transfers)
- Registration/updates of interfaces
    - Sources for ephemeral content generated on the interface - IPFS, Ceramic, HTTPS, etc.
- Blobs of data from each separate interface
    - Follow/unfollow events
    - Update/delete account info/handle
    - Merkle root of all new content generated by the interface
- Root hash of the state (connections, interfaces & accounts)



# What is in a block

- account actions
    - token transfers
    - IDM-like:
        - create new accounts without a keypair
        - binding & updating keypairs (changes require signature from the previous key)
        - list of interface authorizations & revocations for accounts that it controls (each of which is just an integer pair - `56 => 661`)
    - Interface-like:
        - content blob Merkle root
        - content blob IPFS CID
        - list of follow/unfollow actions for accounts (integers pairs - `67 => 27`)
        - Interface-related info updates
            - IPFS node (cluster) address updates
            - keypair updates


- IDM batches
    - list of interface authorizations & revocations (integers pairs - `56 => 661`)
    - follow/unfollow events (integers pairs - `67 => 27`)
    - keypair binding & changes (changes require signature from the previous key)
    - IDM-related info updates
- Interface batches
    - follow/unfollow events (integers pairs - `67 => 27`)
    - content Merkle root
    - content blob IPFS CID 
    - Interface-related info updates
        - IPFS node (cluster) address updates
        - keypair updates
- State root - the Merkle root for the latest materialized state

In reality a single account may play [all 3 roles](identity.md) - normal user, IDM & Interface, so end users may even authorize interfaces & post content themselves as long as they have a keypair & the funds to pay for their direct on-chain transactions. The distinction here is to help paint the picture.

# Materialized state

For Headjack the state throughout history is much more important when compared to financial applications because there will be much more queries to prove things in the past (again and again) compared to just the present. Also, because 


TODO: does the state actually need to contain the historical mapping? not necessarily as third-party services could be doing that, but forcing full nodes to do it properly in the state & maintaining consensus would simplify the architecture of the rest


